let workerCode='let QWorker=class{constructor(){this.listeners=new Map,this.logging=!1;let e=new Map,r=!1,t=!1,i=this,o=!1,s=!1,n=!1,a=6e4,l=18e4,g=new Map,p=!1,d=Date.now(),h=function(){i.log("Worker "+r+" sending request to shut down");clearInterval(QOper8Worker.timer),postMessage({qoper8:{shutdown:!0}}),i.emit("shutdown_signal_sent")},c=function(e){(e=e||{}).qoper8||(e.qoper8={}),e.qoper8.finished=!0,postMessage(e),i.emit("finished",e),o=!1,s&&h()};this.onMessage=function(f){let m;if(d=Date.now(),o=!0,f.qoper8&&f.qoper8.init&&void 0!==f.qoper8.id)return t?(m="QOper8 Worker "+r+" has already been initialised",i.emit("error",m),c({error:m,originalMessage:f})):(r=f.qoper8.id,n=f.qoper8.uuid,f.qoper8.workerInactivityCheckTime&&(a=f.qoper8.workerInactivityCheckTime),f.qoper8.workerInactivityLimit&&(l=f.qoper8.workerInactivityLimit),f.qoper8.handlersByMessageType&&(g=f.qoper8.handlersByMessageType),i.logging=f.qoper8.logging,p=setInterval(function(){let e=Date.now()-d;i.log("Worker "+r+" inactive for "+e),i.log("Inactivity limit: "+l),e>l&&(o?(i.log("Worker "+r+" flagged for termination"),s=!0):h())},a),i.log("new worker "+r+" started..."),i.emit("started",{id:r}),t=!0,c());if(!f.qoper8||!f.qoper8.uuid)return m="Invalid message sent to QOper8 Worker "+r,i.emit("error",m),c({error:m,originalMessage:f});if(f.qoper8.uuid!==n)return m="Invalid UUID on message sent to QOper8 Worker "+r,i.emit("error",m),c({error:m,originalMessage:f});let u=JSON.parse(JSON.stringify(f));if(delete f.qoper8.uuid,delete u.qoper8,i.log("Message received by worker "+r+": "+JSON.stringify(u,null,2)),i.emit("received",{message:u}),!f.type&&!f.handlerUrl)return m="No type or handler specified in message sent to worker "+r,i.emit("error",m),c({error:m,originalMessage:u});if(!f.type||!g.has(f.type))return m="No handler for messages of type "+f.type,i.log(m),i.emit("error",m),c({error:m,originalMessage:u});if(!e.has(f.type)){let t=g.get(f.type);i.log("fetching "+t);try{importScripts(t);let o=self.handler;e.set(f.type,o),i.emit("handler_imported",{handlerUrl:t})}catch(e){return m="Unable to load Handler Url "+t,i.log(m),i.log(JSON.stringify(e,null,2)),i.emit("error",m),c({error:m,originalMessage:u,workerId:r})}}e.get(f.type).call(i,f,c)}}log(e){this.logging&&console.log(Date.now()+": "+e)}on(e,r){this.listeners.has(e)||this.listeners.set(e,r)}off(e){this.listeners.has(e)&&this.listeners.delete(e)}emit(e,r){if(this.listeners.has(e)){this.listeners.get(e).call(this,r)}}},QOper8Worker=new QWorker;onmessage=async function(e){QOper8Worker.onMessage(e.data)};';class QOper8{constructor(e){(e=e||{}).workerInactivityCheckInterval&&(e.workerInactivityCheckInterval=1e3*e.workerInactivityCheckInterval),e.workerInactivityLimit&&(e.workerInactivityLimit=6e4*e.workerInactivityLimit),this.name="QOper8",this.build="2.4",this.buildDate="7 August 2022",this.logging=e.logging||!1,this.poolSize=e.poolSize||1,this.worker={inactivityCheckInterval:e.workerInactivityCheckInterval||6e4,inactivityLimit:e.workerInactivityLimit||12e5},this.handlersByMessageType=e.handlersByMessageType||new Map,this.listeners=new Map;let r="https:"===window.location.protocol?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)):"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let r=16*Math.random()|0,i="x"==e?r:3&r|8;return i.toString(16)}),i=new Map,t=new Map,o=new Map,n=[],s=0,a=this;function l(){if(a.log("try processing queue: length "+n.length),0===n.length)return void a.log("Queue empty");let e=function(){for(const[e,r]of i){if(r.id=e,t.get(+r.id))return r;a.log("worker "+e+" is not available")}return!1}();e?(a.log("worker "+e.id+" was available. Sending message to it"),function(e){if(0===n.length)return;let r=n.shift(),i=e.id;o.set(i,r.qoper8.callback),delete r.qoper8.callback,t.set(+i,!1),g(r,e),a.emit("sentToWorker",{message:r,workerId:i})}(e)):(a.log("no available workers"),i.size<a.poolSize&&(a.log("starting new worker"),function(){let e,r=a.createUrl(workerCode);r?e=new Worker(r):(e={}).postMessage=function(e){};e.onmessage=function(r){let n=r.data,s=JSON.parse(JSON.stringify(n));if(delete s.qoper8,a.emit("replyReceived",{reply:s,workerId:e.id}),a.log("response received from Worker: "+e.id),a.log(JSON.stringify(s,null,2)),o.has(e.id)){let r=o.get(e.id);r&&r(n),o.delete(e.id)}n.qoper8&&(n.qoper8.finished?(t.set(+e.id,!0),l()):n.qoper8.shutdown&&(a.log("Master shutting down worker "+e.id),i.delete(e.id),a.emit("workerTerminated",e.id),e.terminate()))},e.id=s++,g({qoper8:{init:!0,id:e.id,handlersByMessageType:a.handlersByMessageType,workerInactivityCheckTime:a.worker.inactivityCheckTime,workerInactivityLimit:a.worker.inactivityLimit,logging:a.logging}},e),i.set(e.id,e),a.emit("workerStarted",e.id)}()))}function g(e,i){e.qoper8||(e.qoper8={}),e.qoper8.uuid=r,i.postMessage(e)}this.addToQueue=function(e){n.push(e),a.emit("addedToQueue",e),l()}}log(e){this.logging&&console.log(Date.now()+": "+e)}message(e,r){e.qoper8||(e.qoper8={}),e.qoper8.callback=r||!1,this.addToQueue(e)}send(e){let r=this;return new Promise(i=>{r.message(e,function(e){i(e)})})}createUrl(e){let r,i;try{r=new Blob([e],{type:"application/javascript"})}catch(i){try{let i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);i.append(e),r=i.getBlob("application/javascript")}catch(e){return!1}}try{i=(window.URL||window.webkitURL).createObjectURL(r)}catch(e){i=!1}return i}on(e,r){this.listeners.has(e)||this.listeners.set(e,r)}off(e){this.listeners.has(e)&&this.listeners.delete(e)}emit(e,r){if(this.listeners.has(e)){this.listeners.get(e).call(this,r)}}}export{QOper8};